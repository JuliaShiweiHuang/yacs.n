setup:
  addons:
    - plan: heroku-postgresql
      as: yacs_db
  config:
    POSTGRES_DB: yacs
    POSTGRES_USER: yacs
    POSTGRES_PASSWORD: easy_dev_pass
build:
  docker:
    yacs_web: ./src/web/Dockerfile
    yacs_api: ./src/api/Dockerfile
  config:
    HOST: ${HEROKU_APP_NAME}
    ADMIN_PASS: admin
    ENV: production
    DEBUG: False
    DB_HOST: yacs_db
    DB_USER: yacs
    DB_PASS: easy_dev_pass
    DB_NAME: yacs
    DB_PORT: 5432
    WORKERS: 4
    FLASK_SIGN_KEY: secretKey
run:
  yacs_web: nginx -g "daemon off;"
  yacs_api: python tables/database_session.py && PYTHONPATH=. alembic upgrade head && gunicorn --bind 0.0.0.0:5000 -w $WORKERS wsgi:app